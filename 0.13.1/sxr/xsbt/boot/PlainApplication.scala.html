<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>xsbt/boot/PlainApplication.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> xsbt
<span class="keyword">package</span> boot

<span class="comment">/** A wrapper around 'raw' static methods to meet the sbt application interface. */</span>
<span class="keyword">class</span> <a title="class PlainApplication extends Object with xsbti.AppMain" id="xsbt.boot;PlainApplication">PlainApplication</a> <a href="#xsbt.boot;PlainApplication" title="xsbt.boot.PlainApplication" class="keyword">private</a> <span class="delimiter">(</span><a title="java.lang.reflect.Method" id="xsbt.boot;PlainApplication.mainMethod">mainMethod</a>: java.lang.reflect.<span title="java.lang.reflect.Method">Method</span><span class="delimiter">)</span> <span class="keyword">extends</span> xsbti.<a href="../../xsbti/AppMain.java.html#xsbti;AppMain" title="xsbti.AppMain">AppMain</a> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(configuration: xsbti.AppConfiguration)xsbti.MainResult" id="xsbt.boot;PlainApplication.run">run</a><span class="delimiter">(</span><a title="xsbti.AppConfiguration" id="xsbt.boot;PlainApplication.run.configuration">configuration</a>: xsbti.<a href="../../xsbti/AppConfiguration.java.html#xsbti;AppConfiguration" title="xsbti.AppConfiguration">AppConfiguration</a><span class="delimiter">)</span>: xsbti.<a href="../../xsbti/MainResult.java.html#xsbti;MainResult" title="xsbti.MainResult">MainResult</a> = <span class="delimiter">{</span>
    <span class="comment">// TODO - Figure out if the main method returns an Int...</span>
    <span class="keyword">val</span> <a title="Class[Int]" id="xsbt.boot;PlainApplication.run.IntClass">IntClass</a> = classOf<span title="Class[Int](classOf[scala.Int])" class="delimiter">[</span>Int<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="Class[xsbti.Exit]" id="xsbt.boot;PlainApplication.run.ExitClass">ExitClass</a> = classOf<span title="Class[xsbti.Exit](classOf[xsbti.Exit])" class="delimiter">[</span>xsbti.Exit<span class="delimiter">]</span>
    <span class="comment">// It seems we may need to wrap exceptions here...</span>
    <span class="keyword">try</span> <a href="#xsbt.boot;PlainApplication.mainMethod" title="java.lang.reflect.Method">mainMethod</a>.<span title="()Class[_]">getReturnType</span> <span title="xsbti.MainResult" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#xsbt.boot;PlainApplication.run.ExitClass" title="Class[xsbti.Exit]">ExitClass</a> =&gt;
          <a href="#xsbt.boot;PlainApplication.mainMethod" title="java.lang.reflect.Method">mainMethod</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[Object])Object">invoke</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#xsbt.boot;PlainApplication.run.configuration" title="xsbti.AppConfiguration">configuration</a>.<a href="../../xsbti/AppConfiguration.java.html#xsbti;AppConfiguration.arguments" title="()Array[String]">arguments</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="xsbti.Exit" class="delimiter">[</span>xsbti.<a href="../../xsbti/Exit.java.html#xsbti;Exit" title="xsbti.Exit">Exit</a><span class="delimiter">]</span>
        <span class="keyword">case</span> <a href="#xsbt.boot;PlainApplication.run.IntClass" title="Class[Int]">IntClass</a> =&gt;
          <a href="#xsbt.boot.PlainApplication" title="xsbt.boot.PlainApplication.type">PlainApplication</a>.<a href="#xsbt.boot.PlainApplication.Exit.readResolve" title="(code: Int)xsbt.boot.PlainApplication.Exit">Exit</a><span class="delimiter">(</span><a href="#xsbt.boot;PlainApplication.mainMethod" title="java.lang.reflect.Method">mainMethod</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[Object])Object">invoke</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#xsbt.boot;PlainApplication.run.configuration" title="xsbti.AppConfiguration">configuration</a>.<a href="../../xsbti/AppConfiguration.java.html#xsbti;AppConfiguration.arguments" title="()Array[String]">arguments</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; 
          <span class="comment">// Here we still invoke, but return 0 if sucessful (no exceptions).</span>
          <a href="#xsbt.boot;PlainApplication.mainMethod" title="java.lang.reflect.Method">mainMethod</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[Object])Object">invoke</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#xsbt.boot;PlainApplication.run.configuration" title="xsbti.AppConfiguration">configuration</a>.<a href="../../xsbti/AppConfiguration.java.html#xsbti;AppConfiguration.arguments" title="()Array[String]">arguments</a><span class="delimiter">)</span>
          <a href="#xsbt.boot.PlainApplication" title="xsbt.boot.PlainApplication.type">PlainApplication</a>.<a href="#xsbt.boot.PlainApplication.Exit.readResolve" title="(code: Int)xsbt.boot.PlainApplication.Exit">Exit</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="comment">// This is only thrown if the underlying reflective call throws.</span>
      <span class="comment">// Let's expose the underlying error.</span>
      <span class="keyword">case</span> <a title="java.lang.reflect.InvocationTargetException" id="xsbt.boot;PlainApplication.run.e">e</a>: java.lang.reflect.<span title="java.lang.reflect.InvocationTargetException">InvocationTargetException</span> <span class="keyword">if</span> <a href="#xsbt.boot;PlainApplication.run.e" title="java.lang.reflect.InvocationTargetException">e</a>.<span title="()Throwable">getCause</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <a href="#xsbt.boot;PlainApplication.run.e" title="java.lang.reflect.InvocationTargetException">e</a>.<span title="()Throwable">getCause</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
<span class="comment">/** An object that lets us detect compatible &quot;plain&quot; applications and launch them reflectively. */</span>
<span class="keyword">object</span> <a title="xsbt.boot.PlainApplication.type" id="xsbt.boot.PlainApplication">PlainApplication</a> <a href="#xsbt.boot.PlainApplication" title="xsbt.boot.PlainApplication.type" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="(clazz: Class[_])Boolean" id="xsbt.boot.PlainApplication.isPlainApplication">isPlainApplication</a><span class="delimiter">(</span><a title="Class[_]" id="xsbt.boot.PlainApplication.isPlainApplication.clazz">clazz</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#xsbt.boot.PlainApplication.findMainMethod" title="(clazz: Class[_])Option[java.lang.reflect.Method]">findMainMethod</a><span class="delimiter">(</span><a href="#xsbt.boot.PlainApplication.isPlainApplication.clazz" title="Class[_]">clazz</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span>
  <span class="keyword">def</span> <a title="(clazz: Class[_])xsbti.AppMain" id="xsbt.boot.PlainApplication.apply">apply</a><span class="delimiter">(</span><a title="Class[_]" id="xsbt.boot.PlainApplication.apply.clazz">clazz</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: xsbti.<a href="../../xsbti/AppMain.java.html#xsbti;AppMain" title="xsbti.AppMain">AppMain</a> =
   <a href="#xsbt.boot.PlainApplication.findMainMethod" title="(clazz: Class[_])Option[java.lang.reflect.Method]">findMainMethod</a><span class="delimiter">(</span><a href="#xsbt.boot.PlainApplication.apply.clazz" title="Class[_]">clazz</a><span class="delimiter">)</span> <span title="xsbti.AppMain" class="keyword">match</span> <span class="delimiter">{</span>
     <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="java.lang.reflect.Method" id="xsbt.boot.PlainApplication.apply.method">method</a><span class="delimiter">)</span> =&gt; <span title="xsbt.boot.PlainApplication" class="keyword">new</span> <a href="#xsbt.boot;PlainApplication" title="xsbt.boot.PlainApplication">PlainApplication</a><span class="delimiter">(</span><a href="#xsbt.boot.PlainApplication.apply.method" title="java.lang.reflect.Method">method</a><span class="delimiter">)</span>
     <span class="keyword">case</span> <span title="None.type">None</span> =&gt; sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="String(&quot;Class: &quot;)" class="string">&quot;Class: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#xsbt.boot.PlainApplication.apply.clazz" title="Class[_]">clazz</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; does not have a main method!&quot;)" class="string">&quot; does not have a main method!&quot;</span><span class="delimiter">)</span>
   <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: Class[_])Option[java.lang.reflect.Method]" id="xsbt.boot.PlainApplication.findMainMethod">findMainMethod</a><span class="delimiter">(</span><a title="Class[_]" id="xsbt.boot.PlainApplication.findMainMethod.clazz">clazz</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[java.lang.reflect.Method]">Option</span><span class="delimiter">[</span>java.lang.reflect.Method<span class="delimiter">]</span> =
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.lang.reflect.Method" id="xsbt.boot.PlainApplication.findMainMethod.method">method</a> = 
        <a href="#xsbt.boot.PlainApplication.findMainMethod.clazz" title="Class[_]">clazz</a>.<span title="(x$1: String, x$2: &lt;repeated...&gt;[Class[_]])java.lang.reflect.Method">getMethod</span><span class="delimiter">(</span><span title="String(&quot;main&quot;)" class="string">&quot;main&quot;</span>, classOf<span title="Class[Array[String]](classOf[[Ljava.lang.String;])" class="delimiter">[</span>Array<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
      <span title="Option[java.lang.reflect.Method]" class="keyword">if</span><span class="delimiter">(</span>java.lang.reflect.<span title="java.lang.reflect.Modifier.type">Modifier</span>.<span title="(x$1: Int)Boolean">isStatic</span><span class="delimiter">(</span><a href="#xsbt.boot.PlainApplication.findMainMethod.method" title="java.lang.reflect.Method">method</a>.<span title="()Int">getModifiers</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: java.lang.reflect.Method)Some[java.lang.reflect.Method]">Some</span><span class="delimiter">(</span><a href="#xsbt.boot.PlainApplication.findMainMethod.method" title="java.lang.reflect.Method">method</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="None.type">None</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="NoSuchMethodException" id="xsbt.boot.PlainApplication.findMainMethod.n">n</a>: <span title="NoSuchMethodException">NoSuchMethodException</span> =&gt; <span title="None.type">None</span>
    <span class="delimiter">}</span>

  <span class="keyword">case class</span> <a title="class Exit extends Object with xsbti.Exit with Product with Serializable" id="xsbt.boot.PlainApplication.Exit.readResolve">Exit</a><a href="#xsbt.boot.PlainApplication.Exit.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="xsbt.boot.PlainApplication;Exit.code">code</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> xsbti.<a href="../../xsbti/Exit.java.html#xsbti;Exit" title="xsbti.Exit">Exit</a>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
